<!-- Admin pairings partial — swapped via SSE -->
{% if pairings %}
<div class="flex justify-between mb-4">
  <div class="text-xs font-semibold text-slate-500 tracking-[0.08em] uppercase">
    Round {{ state.round_number }} Pairings
  </div>
  <div class="text-[13px] text-slate-400">
    Avg: <span class="text-green-500 font-semibold">{{ "%.0f"|format(pairings|map(attribute='score')|list|sum / pairings|length) }}</span>
    &middot;
    Low: <span class="text-amber-500 font-semibold">{{ "%.0f"|format(pairings|map(attribute='score')|list|min) }}</span>
  </div>
</div>

<div class="flex flex-col gap-1">
  {% for p in pairings %}
  <div class="flex items-center justify-between px-4 py-3 bg-midnight rounded-lg">
    <div class="flex items-center gap-4">
      <span class="font-mono text-xs text-slate-500 font-semibold min-w-[60px]">TABLE {{ p.table_number }}</span>
      <span class="text-sm font-medium">
        {% if p.token_a %}<a href="/{{ slug }}/a/{{ p.token_a }}" target="_blank" class="profile-link">{{ p.name_a }}</a>{% else %}{{ p.name_a }}{% endif %}
        <span class="text-slate-600 mx-1.5">&#8596;</span>
        {% if p.token_b %}<a href="/{{ slug }}/a/{{ p.token_b }}" target="_blank" class="profile-link">{{ p.name_b }}</a>{% else %}{{ p.name_b }}{% endif %}
      </span>
    </div>
    <div class="font-mono text-[13px] font-semibold {% if p.score >= 80 %}score-high{% elif p.score >= 60 %}score-medium{% else %}score-low{% endif %}">{{ "%.0f"|format(p.score) }}</div>
  </div>
  {% endfor %}

  {% if pit_stop_info %}
  <div class="flex items-center gap-4 px-4 py-3 bg-pit-stop rounded-lg border border-pit-stop-border">
    <span class="text-base">&#9749;</span>
    <span class="text-sm text-amber-500">Pit Stop: {% if pit_stop_info.token %}<a href="/{{ slug }}/a/{{ pit_stop_info.token }}" target="_blank" class="profile-link">{{ pit_stop_info.name }}</a>{% else %}{{ pit_stop_info.name }}{% endif %}</span>
  </div>
  {% endif %}
</div>

<!-- Override -->
<div class="mt-5 p-4 bg-midnight rounded-lg border border-slate-800">
  <div class="text-xs font-semibold text-slate-500 mb-2.5 tracking-[0.08em] uppercase">
    Override
  </div>
  <form hx-post="/api/admin/swap" hx-swap="none" class="flex items-center gap-2.5"
        onsubmit="resolveSwapIds(this)">
    <input type="hidden" name="attendee_id_1" id="swap-id-1">
    <input type="text" id="swap-input-1" list="swap-list-1" placeholder="Type to filter..."
           class="flex-1 input-dark bg-gray-900 rounded-md px-2.5 text-[13px] h-[30px]">
    <datalist id="swap-list-1">
      {% for id, att in attendees.items()|sort(attribute='1.name') %}
        {% if att.status.value == 'checked-in' %}
        <option value="{{ att.name }}" data-id="{{ id }}">
        {% endif %}
      {% endfor %}
    </datalist>
    <span class="text-slate-600">&#8596;</span>
    <input type="hidden" name="attendee_id_2" id="swap-id-2">
    <input type="text" id="swap-input-2" list="swap-list-2" placeholder="Type to filter..."
           class="flex-1 input-dark bg-gray-900 rounded-md px-2.5 text-[13px] h-[30px]">
    <datalist id="swap-list-2">
      {% for id, att in attendees.items()|sort(attribute='1.name') %}
        {% if att.status.value == 'checked-in' %}
        <option value="{{ att.name }}" data-id="{{ id }}">
        {% endif %}
      {% endfor %}
    </datalist>
    <button type="submit" class="bg-slate-800 text-slate-200 border border-gray-700 rounded-md px-3.5 font-semibold text-[13px] cursor-pointer whitespace-nowrap h-[30px]">
      Apply Swap
    </button>
  </form>
  <script>
  function resolveSwapIds(form) {
    ['1', '2'].forEach(function(n) {
      var name = document.getElementById('swap-input-' + n).value;
      var opts = document.getElementById('swap-list-' + n).options;
      for (var i = 0; i < opts.length; i++) {
        if (opts[i].value === name) {
          document.getElementById('swap-id-' + n).value = opts[i].dataset.id;
          return;
        }
      }
    });
  }
  </script>
</div>
{% else %}
<div class="text-sm text-slate-500">No pairings yet — start a round to see matches.</div>
{% endif %}
